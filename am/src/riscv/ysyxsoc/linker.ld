/*
 * 地址空间 (Address Space)
 * -------------------------------------------------------------------------
 * [MROM] (0x20000000 - 0x20000FFF)  <-- 程序存储/启动区
 * |-----------------------|
 * |       *(entry)        |  <-- _start (复位向量入口)
 * |-----------------------|
 * |       *(.text*)       |  <-- 所有的 C 代码 (只读)
 * |-----------------------|
 * |      *(.rodata*)      |  <-- 只读常量 (字符串等)
 * |-----------------------|
 * |   .data 的初始值       |  <-- 加载地址 (LMA), 由 _data_lma 指向
 * |   (LMA Copy)          |      (烧录时存放在此)
 * |-----------------------|
 * -------------------------------------------------------------------------
 *
 * -------------------------------------------------------------------------
 * [SRAM] (0x0f000000 - 0x0f001FFF)  <-- 数据运行区
 * |-----------------------| <--- 0x0f000000 (ORIGIN)
 * |   .data/.sdata (VMA)  |  <-- 运行地址 (VMA), 由 _data_start 指向
 * |   (全局初始化变量)     |      (由启动代码从 MROM 搬运过来)
 * |-----------------------| <--- _data_end
 * |       .bss            |  <-- 由 _bss_start 指向
 * |   (全局清零变量)       |      (由启动代码手动清零)
 * |-----------------------| <--- _bss_end / _heap_start
 * |       Heap (堆)       |
 * |          |            |  <-- 向上增长 (malloc)
 * |          V            |
 * |-----------------------| <--- _stack_top (0x0f001000)
 * |       Stack (栈)      |
 * |          |            |  <-- 向下增长 (函数调用)
 * |          V            |
 * |-----------------------| <--- _stack_pointer (0x0f002000)
 * -------------------------------------------------------------------------
 */

ENTRY(_start)

MEMORY {
  MROM (rx)  : ORIGIN = 0x20000000, LENGTH = 4K
  SRAM (rwx) : ORIGIN = 0x0f000000, LENGTH = 8K
}

SECTIONS {
  .text : {
    *(entry)
    *(.text*)
  } > MROM

  .rodata : {
    *(.rodata*)
    . = ALIGN(4);
  } > MROM

  .data : {
    _data_start = .;
    *(.data*)
    *(.sdata*)
    _data_end = .;
  } > SRAM AT > MROM

  _data_lma = LOADADDR(.data);

  .bss : {
    _bss_start = .;
    *(.bss*)
    *(.sbss*)
    *(.scommon)
    _bss_end = .;
  } > SRAM

  _heap_start = .;
  _stack_top = ORIGIN(SRAM) + LENGTH(SRAM) - 0x1000;
  _stack_pointer = ORIGIN(SRAM) + LENGTH(SRAM);
}
